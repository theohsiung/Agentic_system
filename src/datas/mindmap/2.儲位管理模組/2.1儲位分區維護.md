# 2.1 儲位分區維護

# 1. 功能概述 (Overview)
儲位分區維護功能用來管理倉庫內各類儲位分區屬性（如：暫存區、差錯區、庫存區等），
包含新增、修改、刪除與查詢。系統需確保分區編號唯一、各分區屬性與自動化類型之間的
唯一性約束，並避免已被儲位、商品、庫存使用的分區被不當修改或刪除。

---

# 2. 版本紀錄 (Revision History)

| 修訂內容 | 版本  | 作者 | 日期       |
| -------- | ----- | ---- | ---------- |
| 公版初版 | V1.0  | tong | 2025.3.20  |
| 會議確認 | V1.1  | tong | 2025.4.2   |

---

# 3. 功能範圍 (Scope)
- 儲位分區新增
- 儲位分區修改
- 儲位分區刪除
- 儲位分區查詢（含使用狀態標記）

---

# 4. 詳細規格 (Specifications)

========================================================
## 4.1 新增（後端）

### 4.1.1 校驗規則

1. 分區編號不可重複  
   - 訊息：此「分區編號」已重複，請重新輸入  

2. 各類「暫存區 / 差錯區」分區屬性只允許設定一個分區編號  
   - 訊息：「{分區屬性}」只允許設定一個分區編號，請重新輸入！  

3. 當「分區屬性」為「庫存區」，且「自動化類型」設定為非「無」時：  
   - 系統檢查每一種自動化類型僅能設定一個分區編號  
   - 訊息：每一個自動化類型只能設定一個分區編號，請確認！  

### 4.1.2 後端邏輯

1. 生成儲位分區物件  
   - 欄位：分區編號、分區名稱、分區屬性  

2. 記錄其他資料  
   - 如：溫層、建立人員、建立時間…等  

3. 寫入資料庫  

4. 發布儲位分區新增事件  
   - `EventName.CreateSpaceCategory` (Hand)  

---

========================================================
## 4.2 修改（後端）

### 4.2.1 校驗規則

1. 若有「修改分區屬性」：  
   - 校驗各暫存區、差錯區分區屬性只允許設定一個編號  
   - 訊息：「{分區屬性}」只允許設定一個分區編號，請重新輸入  

2. 若有「修改分區屬性」，需校驗是否已設定儲位：  
   - 該儲位分區 \[{0}\] 已被儲位使用，{1} 禁止修改  

3. 當修改「溫層 / 高單價 / 異型品」時，需檢查是否已有指派商品：  
   - 該儲位分區 \[{0}\] 已有儲位綁定商品，{1} 禁止修改  

4. 當修改「溫層 / 高單價 / 異型品」時，需檢查是否已有庫存：  
   - 該儲位分區 \[{0}\] 已有庫存，{1} 禁止修改  

5. 當修改「自動化類型」時：  
   - 每一個自動化類型只能設定一個分區編號  
   - 訊息：每一個自動化類型只能設定一個分區編號，請確認！  

### 4.2.2 後端邏輯

1. 依 S_ID 取得儲位分區物件  

2. 修改相關欄位  
   - 包含：分區名稱、溫層、分區屬性、高單價、異型品、自動化類型、修改人員、修改時間等  

3. 寫入資料庫  

4. 發布儲位分區修改事件  
   - `EventName.UpdateSpaceCategory` (Hand)  

---

========================================================
## 4.3 刪除（後端）

### 4.3.1 校驗規則

0. 判斷資料是否存在  
   - 訊息：當前資料已不存在，請重新查詢！  

1. 校驗當前分區編號是否已有庫存資料  
   - 儲位分區 \[{0}\] 已有庫存，禁止刪除（V1.1 排前）  

2. 校驗當前分區編號是否已被儲位使用  
   - 儲位分區 \[{0}\] 已被儲位使用，禁止刪除  

### 4.3.2 後端邏輯

1. 依 S_ID 取得儲位分區物件  

2. 自資料庫刪除  

3. 發布儲位分區刪除事件  
   - `EventName.DeleteSpaceCategory` (Hand)  

---

========================================================
## 4.4 查詢（後端）

### 4.4.1 查詢回傳特殊標記說明

欄位：`I_ISHAVEUSE`  

- 0：未被使用  
- 1：已設定儲位（但未指派商品且無庫存）  
- 2：已設定的儲位中有指派商品  
- 3：有庫存紀錄  

>（你的原始文字是：1=設定位儲位、2=有商品、3=有庫存；我這裡幫你明確加上狀態語意，方便前端與 PM 理解）

### 4.4.2 支援的查詢欄位

- 分區編號  
- 分區屬性  
- 溫層  
- 自動化類型  

### 4.4.3 排序規則

1. 按分區編號由小到大排序  

---

# 5. 前端規格 (Frontend)

## 5.1 校驗

### ＜分區編號＞ → ＜Enter＞

- 校驗「分區編號」是否重複  

---

## 5.2 畫面連動 / 欄位可否修改

### ＜分區屬性＞ → ＜Change＞

- 當「分區屬性」為「庫存區」時：  
  - 開放下列欄位供維護（V1.1）：  
    - 儲位溫層\*  
    - 異型品  
    - 高單價  
    - 自動化類型  

### ＜修改＞畫面欄位可修改條件（依 I_ISHAVEUSE）

1. `I_ISHAVEUSE == 0`  
   - 該分區未在【02_02 儲位資料維護】中使用  
   - 除了「分區編號」不可修改，其餘欄位皆可修改  

2. `I_ISHAVEUSE == 2`  
   - 分區已被儲位使用，但未設定專屬商品，且沒有庫存  
   - 「分區屬性」不可修改  
   - 其他欄位皆可修改  

3. `I_ISHAVEUSE == 3`  
   - 分區已被儲位使用，且有設定專屬商品或已有庫存  
   - 僅「分區名稱」可修改  
   - 其他欄位皆不可修改  

---

# 6. 系統事件 (Domain Events)

- `EventName.CreateSpaceCategory`  
- `EventName.UpdateSpaceCategory`  
- `EventName.DeleteSpaceCategory`  